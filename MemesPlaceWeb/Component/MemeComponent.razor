@inject IMemesService memeService
@inject NavigationManager nav
@using System.Security.Claims
<MudCard Elevation="1" >
    <MudCardHeader>
        <CardHeaderAvatar>
            <MudAvatar Color="Color.Secondary" Image="@meme.ImgProfile" >@meme.UserName</MudAvatar>
        </CardHeaderAvatar>
        <CardHeaderContent>
           
                <MudButton OnClick="@BnClick">@meme.Name</MudButton>
         
            
            <MudText Typo="Typo.body2">@meme.Description</MudText>
        </CardHeaderContent>
        <CardHeaderActions>
            <AuthorizeView>
                <Authorized>
                    @if (context.User.Identity.Name==meme.UserName){
<MudIconButton Icon="@Icons.Material.Filled.Settings" Color="Color.Default" />
                    } </Authorized>
                   
            </AuthorizeView>
           
        </CardHeaderActions>
    </MudCardHeader>
 
    
    <MudCardContent Style="text-align: center;height:800; ">
        @if (meme.IsVideo)
        {

            <video controls="" style="width:fit-content; max-height: 800px;"  name="media" ondblclick="@imgClick"><source src="@meme.Urlimg" type="@meme.Format"></video>
        }
        else
        {
            <MudImage ondblclick="@imgClick" ObjectFit="ObjectFit.ScaleDown" ObjectPosition="ObjectPosition.Center" Height="600" Src="@meme.Urlimg" Style="max-height: 800px;"></MudImage>
        }</MudCardContent>
        <MudCardContent Class="m-lg-1">
           @foreach (var tag in meme.Tags)
        {
            <MudButton  >@tag</MudButton>
        }

        </MudCardContent>
        
    
    <MudCardActions>
        @if(meme.Like){
            <MudIconButton Icon="@Icons.Material.Filled.Favorite" Color="Color.Error" OnClick="Like" />
        }else{
            <MudIconButton Icon="@Icons.Material.Filled.Favorite" Color="Color.Default" OnClick="Like" />
        }
       
        <MudIconButton Icon="@Icons.Material.Filled.Share" Color="Color.Default" />
    </MudCardActions>
</MudCard>
@code {
    [Parameter]
    public MemeDTO meme { get; set; }
    [Parameter]
    public bool IsFull { get; set; } = false;
    [Inject] private IDialogService DialogService { get; set; }
    private async Task Like()
    {
        var response = await memeService.Like(meme.Id);
        if (!response.IsSuccess)
        {
            bool? result = await DialogService.ShowMessageBox(
              "Warning",
              "Error Liking the meme"
              );


        }
        meme.Like =response.Data;
        StateHasChanged();
    }
    private void BnClick()
    {
        if (!IsFull)
            nav.NavigateTo($"/Meme/{meme.Id}");
    }
    private async void imgClick()
    {
        if (!IsFull)
            nav.NavigateTo($"/Meme/{meme.Id}");
        else
            await Like();
    }
}
